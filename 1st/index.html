<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <script src="http://code.jquery.com/jquery1.10.2.min.js"></script>
        <script type="text/javascript" src="js/three.min.js"></script>
        <script type="text/javascript" src="js/Detector.js"></script>
        <script type="text/javascript" src="js/OrbitControls.js"></script>
        <script src="js/THREEx.KeyboardState.js"></script>
        <script src="js/THREEx.FullScreen.js"></script>
        <script src="js/THREEx.WindowResize.js"></script>
        <title>Room</title>
        <style type="text/css">
            canvas {
                width: 100%; height: 100%;
                border: 1px solid #000000; }

            #outer {
                width: 452px; 
                border: 1px solid #000000; }

            #furniture {
                border-bottom: 0;
                display: none; }

            #roomsize {
                display: none; }

            .input {
                padding: 10px 0 0 5px;
                display: none; }

            .input button {
                margin: 10px 30px 0 0;
                float: right; }

            .box {
                width: 450px; height: 20px;
                border-bottom: 1px solid #000000;
                padding: 5px 0 5px 2px;
                cursor: pointer; }

            #info {
                color: #F0F0F0;
                background: #2f2f2f; }

            .bwrap {
                margin: 0.5em 0 0 0; }

            button {
                border: 0;
                background: #000;
                color: #fff;
                padding: 0.2em 0.5em;
                cursor: pointer;
                borderradius: 3px; }

            button:hover {
                background: #4f4f4f; }
        </style>
    </head>
    <body>
<!--  <div id="outer">
      <div id="controller" class="box">
        Controller ▲ 
      </div>
      <div id="roomsize" class="box">
        Roomsize ▲
        <div class="input">
          <form method="get">
                <input type="text" name="width" id="width" size="20" maxlength="3" placeholder="가로 길이" /> x 
                <input type="text" name="leng" id="leng" size="20" maxlength="3" placeholder="세로 길이" /> x
                <input type="text" name="height" id="height" size="20" maxlength="3" placeholder="높이" />
                <button type="button">만들기</button>
            </form>
        </div>
      </div>
      <div id="furniture" class="box">
        Furniture ▲
      </div>-->
    <div id="room"></div>

    <!-- button test start -->
    <div id="info">
      <div id="btn_chair">
        가구 : 
        <button type="button" id="create_chair">의자</button>
        <button type="button" id="textures">벽지</button>
      </div>
    </div>
    <!-- button test over -->
    <script type="text/javascript">
        // standard global variables
        var container, scene, camera, renderer, controls, stats;
        var keyboard = new THREEx.KeyboardState();
        var clock = new THREE.Clock();
        var cuttentIdx = 0;  //  현재 화면 상에 보이는 object
        var Objects = [];
        var materials =[];

        //버튼
        var Buttons = {
            "create_chair" : {
                idx : 1
            },
            "textures" : {
                idx : 2
            }
        };

        for (var b in Buttons)
        initButtons(b);
        // // custom global variables
        // var mesh;

        /* //재질
        var texture = new THREE.Texture(generateTexture());
        texture.needsUpdate = true;

        var earthTexture = new THREE.Texture();
        var loader = new THREE.ImageLoader();

        loader.addEventListener('load', function(event) {

        earthTexture.image = event.content;
        earthTexture.needsUpdate = true;

        }); */

        init();
        animate();
        // FUNCTIONS     
        function init() {
            // SCENE
            scene = new THREE.Scene();

            var geometry = new THREE.Geometry(); //add

            // CAMERA
            var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
            var VIEW_ANGLE = 45, ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT, NEAR = 0.1, FAR = 20000;
            camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);

            scene.add(camera);

            camera.position.set(0,150,400);
            camera.lookAt(scene.position);  

            // RENDERER
            if ( Detector.webgl )
                renderer = new THREE.WebGLRenderer( {antialias:true} );
            else
                renderer = new THREE.CanvasRenderer(); 
                renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
                container = document.getElementById('room');
                container.appendChild( renderer.domElement );

            // EVENTS
            THREEx.WindowResize(renderer, camera);
            THREEx.FullScreen.bindKey({ charCode : 'm'.charCodeAt(0) });

            // CONTROLS
            controls = new THREE.OrbitControls( camera, renderer.domElement );

            // LIGHT
            var light = new THREE.PointLight(0xffffff);
            light.position.set(100,250,100);

            scene.add(light);
            
            //방 모양 틀 만들기
            var gridXZ = new THREE.GridHelper(100, 10);
            gridXZ.setColors( new THREE.Color(0x006600), new THREE.Color(0x006600) );
            gridXZ.position.set( 100,0,100 );

            scene.add(gridXZ);

            var gridXY = new THREE.GridHelper(100, 10);
            gridXY.position.set( 100,100,0 );
            gridXY.rotation.x = Math.PI/2;
            gridXY.setColors( new THREE.Color(0x000066), new THREE.Color(0x000066) );

            scene.add(gridXY);

            var gridYZ = new THREE.GridHelper(100, 10);
            gridYZ.position.set( 0,100,100 );
            gridYZ.rotation.z = Math.PI/2;
            gridYZ.setColors( new THREE.Color(0x660000), new THREE.Color(0x660000) );

            scene.add(gridYZ);

            furniture();
            textures();
          }

        function furniture () {

            // 상자 생성 ==================================

            var geometry = new THREE.CubeGeometry( 100, 100, 100 );
            var texture = THREE.ImageUtils.loadTexture( 'textures/wood.jpg' );

            texture.anisotropy = renderer.getMaxAnisotropy();

            var material = new THREE.MeshBasicMaterial( { map: texture } );
            mesh = new THREE.Mesh( geometry, material );

            scene.add( mesh );

            mesh.position.set (50, 50, 50);
            mesh.visible = false;
        }

        //벽지 입히기 
        //(5, 5) 정도로 그리고 그것이 gridXZ, gridYZ에 나타나야 함
        function textures() {
            var geometryXZ = new THREE.CubeGeometry( 0, 200, 200 ); //CubeGeometry(width, height, depth) = (z, y, x)
            var textureXZ = THREE.ImageUtils.loadTexture( 'textures/first.jpg' );

            textureXZ.anisotropy = renderer.getMaxAnisotropy();

            var materialXZ = new THREE.MeshBasicMaterial( { map: textureXZ } );
            meshXZ = new THREE.Mesh( geometryXZ, materialXZ );

            scene.add( meshXZ );

            meshXZ.position.set (0, 100, 100);
            meshXZ.visible = false;

            var geometryYZ = new THREE.CubeGeometry( 200, 200, 0 ); //CubeGeometry(width, height, depth) = (z, y, x)
            var textureYZ = THREE.ImageUtils.loadTexture( 'textures/first.jpg' );

            textureYZ.anisotropy = renderer.getMaxAnisotropy();

            var materialYZ = new THREE.MeshBasicMaterial( { map: textureYZ } );
            meshYZ = new THREE.Mesh( geometryYZ, materialYZ );

            scene.add( meshYZ );

            meshYZ.position.set (100, 100, 0);
            meshYZ.visible = false;
        }
        
        function initButtons (btn){
            $(btn).addEventListener('click', function() {
                if(btn == "create_chair"){
                    if(!mesh.visible)
                        mesh.visible = true;
                    else
                        mesh.visible = false;
                }
                else if(btn == "textures"){
                    if(!meshXZ.visible || !meshYZ.visible) {
                        meshXZ.visible = true;
                        meshYZ.visible = true;
                    }
                    else {
                        meshXZ.visible = false;
                        meshYZ.visible = false;
                    }
                }
            }, false);
        }

        // function initButtons() {
        //     $('create_chair').click(function() {
        //         if(!mesh.visible) {
        //             mesh.visible = true;
        //             console.log('test1');
        //         }
        //         else {
        //             mesh.visible = false;
        //             console.log('chair visible');
        //         }
        //     });
        //     $('textures').click(function() {
        //         if(!meshXZ.visible) {
        //             meshXZ.visible = true;
        //             console.log('texture invisible');
        //         }
        //         else {
        //             meshXZ.visible = false;
        //             console.log('texture visible');
        //         }
        //     });
        // }
            

        function animate() {
            requestAnimationFrame( animate );
            render();    
            update();
        }

        function update() {
        // if ( keyboard.pressed("z") ) 
        // {  // do something   
        // }
            controls.update();
            //stats.update();
        }

        function render() {
            renderer.render( scene, camera );
        }

        //controller
        $(document).ready(function(){
            $('#controller').click(function() {
                $('#furniture').toggle();
                $('#roomsize').toggle();
                $('#furniture').height('20px');
                $('#roomsize').height('20px');
                $('.input').css('display','none');
            });

            $('#roomsize').click(function() {
                $('#furniture').height('20px');
                $('#roomsize').height('100px');
                $('.input').css('display','block');
            });

            $('#furniture').click(function() {
                $('#furniture').height('500px');
                $('#roomsize').height('20px');
                $('.input').css('display','none');
            });

            initButtons();
        });

        function $(id){
            return document.getElementById(id);
        }
    </script>
    </body>
 </html>